<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>è¡Œå‹•æ”¯æ´ã‚¢ãƒ—ãƒª v5.0</title>
  <style>
    /* ===== Theme ===== */
    :root{
      --bg:#dff3f8; --panel:#ffffff; --text:#111827; --muted:#6b7280; --border:#cfe7ee;
      --accent:#22c55e; --accent-press:#16a34a; --warn:#fbbf24; --badge:#0ea5e9; --card:#f6fbfd;
      --shadow:0 8px 20px rgba(0,0,0,.08);
      --cat-ex:#22c55e; --cat-at:#3b82f6; --cat-life:#f59e0b; --cat-list:#0ea5e9;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--text);font-family:Meiryo, "Hiragino Kaku Gothic ProN", "Yu Gothic", system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans JP", sans-serif;}
    .hidden{display:none}

    /* badges & UI */
    h1,h2,h3,.btn,.badge{display:inline-flex;align-items:center;gap:6px;padding:2px 10px;border-radius:999px;font-size:12px;color:#075985;background:#e0f2fe;border:1px solid #bae6fd}
    .badge.accent{background:#dcfce7;color:#166534;border-color:#bbf7d0}
    .badge.warn{background:#fef3c7;color:#78350f;border-color:#fde68a}
    .badge.new{background:#fde68a;color:#92400e;border-color:#fcd34d}
    .badge.cat-ex{background:#dcfce7;color:#166534;border-color:#bbf7d0}
    .badge.cat-at{background:#dbeafe;color:#1e40af;border-color:#bfdbfe}
    .badge.cat-life{background:#fef3c7;color:#78350f;border-color:#fde68a}
    .badge.list{background:#ffffff;color:#0c4a6e;border:2px dashed #93c5fd;border-radius:8px}

    .wrap{max-width:900px;margin:0 auto;padding:16px}
    header{position:sticky;top:0;z-index:30;background:linear-gradient(180deg,rgba(255,255,255,.9),rgba(255,255,255,.6));backdrop-filter:blur(6px);display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--border);padding:12px 16px}
    header h1{font-size:18px;margin:0}

    .btn{appearance:none;border:1px solid transparent;border-radius:12px;padding:10px 14px;font-weight:700;color:white;background:var(--accent);cursor:pointer;box-shadow:var(--shadow)}
    .btn:active{background:var(--accent-press)}
    .btn.secondary{background:#e2f6e9;color:#065f46;border-color:#a7f3d0}
    .btn.ghost{background:#eef7fa;color:#0c4a6e;border:1px solid #c7e6f3}
    .btn:disabled{opacity:.6;cursor:not-allowed}

    .panel{border:1px solid var(--border);background:var(--panel);border-radius:16px;padding:16px;box-shadow:var(--shadow)}
    .cards{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:12px;margin-top:12px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:12px;display:flex;flex-direction:column;gap:8px;min-height:100px}
    /* ã‚¹ãƒãƒ›ã§3ã¤è¦‹ãˆã‚‹ã‚ˆã†ã«ç¸¦ã‚µã‚¤ã‚ºå‰Šæ¸› */
    @media (max-width: 768px) {
      .cards{grid-template-columns:1fr}
      .card{min-height:80px;padding:10px}
    }
    
    /* ã‚¹ã‚¿ãƒ³ãƒ—ä¸€è¦§ã§3åˆ—è¡¨ç¤º */
    .stamps-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-top:16px}
    .stamp-category{display:flex;flex-direction:column;gap:10px}
    .stamp-category h4{margin:0 0 8px;padding:8px;background:var(--card);border-radius:8px;text-align:center;font-size:13px}
    @media (max-width: 768px) {
      .stamps-grid{grid-template-columns:repeat(3,1fr);gap:8px}
      .stamp-category h4{font-size:11px;padding:6px}
      .stamp-category .card{font-size:11px}
      .stamp-category .card .title{font-size:12px}
      .stamp-category .card .sub{font-size:10px}
      .stamp-category .card .btn{font-size:10px;padding:6px 8px}
    }
    .card.cat-exercise{border-top:4px solid var(--cat-ex)}
    .card.cat-attention{border-top:4px solid var(--cat-at)}
    .card.cat-lifestyle{border-top:4px solid var(--cat-life)}
    .card.cat-list{border-top:4px solid var(--cat-list)}

    .title{font-weight:800;font-size:16px}
    .sub{color:var(--muted);font-size:13px;line-height:1.5}
    .inline{display:flex;gap:8px;align-items:center;flex-wrap:wrap}

    .tabbar{position:sticky;bottom:0;left:0;right:0;background:rgba(255,255,255,.85);backdrop-filter:blur(6px);border-top:1px solid var(--border);display:flex;gap:6px;justify-content:space-between;padding:10px 12px;z-index:40}
    .tab{flex:1;display:flex;align-items:center;justify-content:center;background:#ffffff;border:1px solid var(--border);color:var(--text);border-radius:12px;padding:10px;font-weight:700;cursor:pointer}
    .tab.active{outline:2px solid var(--accent)}

    .small{font-size:12px;color:var(--muted)}
    .calendar{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
    .weekday{font-weight:700;color:#0f172a;text-align:center}
    .day{aspect-ratio:1/1;background:#fff;border:1px solid var(--border);border-radius:10px;display:flex;flex-direction:column;justify-content:space-between;padding:6px}
    .day .num{font-weight:700}
    .dot{width:8px;height:8px;border-radius:50%;display:inline-block}
    .dot.g{background:var(--accent)} .dot.b{background:#0ea5e9} .dot.y{background:#fbbf24}

    /* ç¤¾å“¡IDå…¥åŠ›ç”»é¢ */
    .input-group{margin:16px 0}
    .input-group label{display:block;margin-bottom:6px;font-weight:700}
    .input-group input{width:100%;padding:10px;border:1px solid var(--border);border-radius:8px;font-size:14px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1 id="appTitle">è¡Œå‹•æ”¯æ´ã‚¢ãƒ—ãƒª</h1>
      <button class="btn ghost" id="toMenuBtn" aria-controls="menuView">ãƒ¡ãƒ‹ãƒ¥ãƒ¼</button>
    </header>

    <!-- Step0: åŒæ„ç”»é¢ -->
    <section id="consentView" class="panel hidden" aria-live="polite">
      <h2>è¡Œå‹•æ”¯æ´ã‚¢ãƒ—ãƒªåˆ©ç”¨ã«é–¢ã™ã‚‹åŒæ„æ›¸</h2>
      <div class="small" style="line-height:1.7">
        <p style="font-weight:700;margin-bottom:8px">ç§ã¯ã€æœ¬ã‚¢ãƒ—ãƒªãŒé€šä¿¡ã‚’è¡Œã‚ãšã€ç«¯æœ«å†…ã§ã®ã¿å‹•ä½œã™ã‚‹ã‚‚ã®ã§ã‚ã‚‹ã“ã¨ã‚’ç†è§£ã—ã¾ã—ãŸã€‚</p>
        <p>ãƒ»ã‚¢ãƒ—ãƒªå†…ã§è¨˜éŒ²ã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿(æŠ¼å°å±¥æ­´ãƒ»åˆ©ç”¨å›æ•°ãªã©)ã¯ã€è‡ªèº«ã®ç«¯æœ«å†…ã«ã®ã¿ä¿å­˜ã•ã‚Œã€å¤–éƒ¨ã‚µãƒ¼ãƒç­‰ã¸ã®é€ä¿¡ãƒ»åé›†ã¯è¡Œã‚ã‚Œã¾ã›ã‚“ã€‚</p>
        <p>ãƒ»æœ¬ã‚¢ãƒ—ãƒªã®åˆ©ç”¨ç›®çš„ãŒå¥åº·ã¥ãã‚Šãƒ»è¡Œå‹•æ”¯æ´ã®ä¸€ç’°ã§ã‚ã‚Šã€å€‹äººã®è©•ä¾¡ç­‰ã«ã¯ç”¨ã„ã‚‰ã‚Œãªã„ã“ã¨ã‚’ç¢ºèªã—ã¾ã—ãŸã€‚</p>
        <p>ãƒ»åˆ©ç”¨çµ‚äº†å¾Œã¯ã€ã‚¢ãƒ—ãƒªãƒ•ã‚¡ã‚¤ãƒ«ã®å‰Šé™¤ãŠã‚ˆã³ãƒ–ãƒ©ã‚¦ã‚¶ãƒ‡ãƒ¼ã‚¿ã®æ¶ˆå»ã«ã‚ˆã‚Šã€ç«¯æœ«å†…ãƒ‡ãƒ¼ã‚¿ã‚’è‡ªã‚‰ç ´æ£„ã—ã¾ã™ã€‚</p>
      </div>
      <div class="inline" style="margin-top:14px">
        <label style="font-weight:700"><input type="checkbox" id="consentCheck"/> ä¸Šè¨˜ã®å†…å®¹ã‚’èª­ã¿ã€åŒæ„ã—ãŸä¸Šã§åˆ©ç”¨ã‚’é–‹å§‹ã—ã¾ã™</label>
      </div>
      <button class="btn" id="consentBtn" disabled style="margin-top:10px">æ¬¡ã¸</button>
    </section>

    <!-- Step0.5: ç¤¾å“¡IDå…¥åŠ› -->
    <section id="employeeIdView" class="panel hidden">
      <h2>ç¤¾å“¡IDç™»éŒ²</h2>
      <p class="small">æœ€åˆã«ä¸€åº¦ã ã‘ç¤¾å“¡IDã‚’ç™»éŒ²ã—ã¦ãã ã•ã„ã€‚</p>
      <div class="input-group">
        <label for="employeeIdInput">ç¤¾å“¡ID</label>
        <input type="text" id="employeeIdInput" placeholder="ä¾‹: 12345" />
      </div>
      <button class="btn" id="employeeIdBtn">ç™»éŒ²ã—ã¦ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
    </section>

    <!-- HOME -->
    <section id="homeView" class="panel hidden">
      <div style="margin-bottom:14px">
        <div class="inline" style="margin-bottom:8px"><span class="badge accent">ğŸ’š 1åˆ†ã§ã§ãã‚‹å¥åº·è¡Œå‹•ï¼</span></div>
        <p class="small" style="line-height:1.6">ãƒ»<strong>è¿·ã£ãŸã‚‰</strong>ï¼šä»Šæ—¥ã®ãŠã™ã™ã‚ã‚¹ã‚¿ãƒ³ãƒ—ã«å–ã‚Šçµ„ã‚€<br/>ãƒ»<strong>ã‚ªãƒ¼ãƒ€ãƒ¼ãƒ¡ã‚¤ãƒ‰</strong>ï¼šã€Œã‚¹ã‚¿ãƒ³ãƒ—ä¸€è¦§ã€ã‹ã‚‰å¥½ããªé …ç›®ã‚’é¸æŠã§ãã¾ã™</p>
      </div>
      <h3 style="margin:18px 4px 6px">ä»Šæ—¥ã®ãŠã™ã™ã‚ã‚¹ã‚¿ãƒ³ãƒ—</h3>
      <div class="cards" id="recommendList"></div>
      <div class="cards">
        <article class="card cat-list" onclick="show('stampsView')" style="cursor:pointer">
          <div class="inline"><span class="badge list">ä¸€è¦§</span><span class="badge accent">è‡ªç”±é¸æŠ</span></div>
          <div class="title">ã™ã¹ã¦ã®ã‚¹ã‚¿ãƒ³ãƒ—ã‚’è¦‹ã‚‹</div>
          <div class="sub">å…¨30ç¨®ã€‚ã‚«ãƒ†ã‚´ãƒªã‹ã‚‰è‡ªç”±ã«é¸ã‚“ã§æŠ¼ã›ã¾ã™ã€‚</div>
          <div class="inline" style="gap:8px; margin-top:auto"><button class="btn ghost">è¦‹ã‚‹</button></div>
        </article>
      </div>
      <div class="panel" style="margin-top:14px">
        <div class="inline" style="justify-content:space-between;align-items:center">
          <div><strong>æœ¬æ—¥ã®å–ã‚Šçµ„ã¿</strong><div class="small"><span id="dayCount">0</span> å›</div></div>
        </div>
        <div class="inline" style="justify-content:space-between;align-items:center;margin-top:10px">
          <div><strong>ä»Šé€±ã®å–ã‚Šçµ„ã¿</strong><div class="small"><span id="weekCount">0</span> å›</div></div>
        </div>
      </div>
    </section>

    <!-- ã‚¹ã‚¿ãƒ³ãƒ—ä¸€è¦§ -->
    <section id="stampsView" class="panel hidden">
      <div class="inline" style="justify-content:space-between;align-items:center">
        <h3 style="margin:0">ã‚¹ã‚¿ãƒ³ãƒ—ä¸€è¦§ï¼ˆå…¨31ï¼‰</h3>
        <button class="btn ghost" onclick="show('homeView')">ãƒ›ãƒ¼ãƒ ã¸æˆ»ã‚‹</button>
      </div>
      <div class="cards" id="stampsList"></div>
    </section>

    <!-- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ -->
    <section id="calendarView" class="panel hidden">
      <div class="inline" style="justify-content:space-between;align-items:center">
        <div class="inline" style="gap:8px;align-items:center">
          <button class="btn ghost" id="prevMonthBtn" aria-label="å‰ã®æœˆã¸">â—€ï¸</button>
          <h3 id="calHeader" style="margin:0">2025å¹´11æœˆ</h3>
          <button class="btn ghost" id="nextMonthBtn" aria-label="æ¬¡ã®æœˆã¸">â–¶ï¸</button>
        </div>
        <button class="btn ghost" onclick="show('homeView')">ãƒ›ãƒ¼ãƒ ã¸æˆ»ã‚‹</button>
      </div>
      <div class="small" style="margin:6px 0 10px">è‰²ã®ç›®å®‰ï¼š<span class="dot g"></span> å®Ÿæ–½å¤šã‚ / <span class="dot b"></span> æ¨™æº– / <span class="dot y"></span> å°‘ãªã‚</div>
      <div class="calendar" id="calendarGrid" aria-live="polite"></div>
    </section>

    <!-- ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
    <section id="menuView" class="panel hidden">
      <div class="menu-list" style="display:grid;gap:10px">
        <div class="inline" style="justify-content:space-between;align-items:center;border:1px solid var(--border);background:var(--panel);border-radius:14px;padding:14px">
          <div>
            <div class="label" style="font-weight:800">å–ã‚Šçµ„ã¿è¨˜éŒ²ã®æå‡º</div>
            <div class="small" style="margin-top:4px">é€±ã«ä¸€åº¦ã®æå‡ºã‚’å¿ƒãŒã‘ã¾ã—ã‚‡ã†ï¼ˆæ›œæ—¥å›ºå®šã™ã‚‹ã¨å®šç€ã—ã‚„ã™ã„ï¼‰</div>
          </div>
          <button class="btn ghost" onclick="show('submitView')">æå‡º</button>
        </div>
        <div class="inline" style="justify-content:space-between;align-items:center;border:1px solid var(--border);background:var(--panel);border-radius:14px;padding:14px">
          <span class="label" style="font-weight:800">ç¤¾å“¡IDå¤‰æ›´</span>
          <button class="btn ghost" onclick="changeEmployeeId()">å¤‰æ›´</button>
        </div>
      </div>
    </section>

    <!-- æå‡º -->
    <section id="submitView" class="panel hidden">
      <h3 style="margin-top:0">å–ã‚Šçµ„ã¿è¨˜éŒ²ã®æå‡º</h3>
      <p class="small" style="margin-bottom:4px">é€±ã«ä¸€åº¦ã®æå‡ºã‚’å¿ƒãŒã‘ã¾ã—ã‚‡ã†ï¼ˆæ›œæ—¥å›ºå®šã™ã‚‹ã¨å®šç€ã—ã‚„ã™ã„ï¼‰</p>
      <div class="inline" style="gap:10px;flex-wrap:wrap;margin-top:12px">
        <button class="btn" id="submitBtn" style="font-size:16px;padding:12px 20px">å–ã‚Šçµ„ã¿ã‚’æå‡º</button>
        <button class="btn ghost" id="exportBtn" style="font-size:12px">CSVã‚’ä¿å­˜</button>
      </div>
      <p id="submitMsg" class="small" style="margin-top:12px"></p>
    </section>

    <nav class="tabbar">
      <button class="tab" id="homeTab" aria-controls="homeView">ãƒ›ãƒ¼ãƒ </button>
      <button class="tab" id="stampsTab" aria-controls="stampsView">ã‚¹ã‚¿ãƒ³ãƒ—</button>
      <button class="tab" id="calendarTab" aria-controls="calendarView">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</button>
      <button class="tab" id="menuTab" aria-controls="menuView">ãƒ¡ãƒ‹ãƒ¥ãƒ¼</button>
    </nav>
  </div>

  <script>
    // ====== è¨­å®š ======
    const APP_VERSION = '5.0.0';
    const GAS_URL = 'https://script.google.com/macros/s/AKfycby59K37UyAo3-ew0TlCLiiHmVF5Bna_A2zWf9HNy6lfGMRy9p7uP71SgjYG3DM2Roa2/exec'; // GASã®Webã‚¢ãƒ—ãƒªURLã‚’è¨­å®š
    const API_TOKEN = 'b7d9f2k4m6p8q1r3t5v7w9x2c4e6g8h0'; // GASã®API_TOKENã‚’è¨­å®š

    // ====== ã‚¹ã‚¿ãƒ³ãƒ—ãƒ‡ãƒ¼ã‚¿å®šç¾© ======
    const STAMPS = {
      exercise: [
        {id:'core1',cat:'é‹å‹•',title:'ã‚³ã‚¢ãƒˆãƒ¬1ï¼ˆåº§ä½ï¼‰',desc:'ã€Œéª¨ç›¤ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã€ã‚’æ‰‹ã«å…¥ã‚Œã¦è…°ç—›äºˆé˜²ï¼',url:'',video:true},
        {id:'core2',cat:'é‹å‹•',title:'ã‚³ã‚¢ãƒˆãƒ¬2ï¼ˆåº§ä½ï¼‰',desc:'éª¨ç›¤ã¨è¶³ã®é€£å‹•æ€§ã§æ—¥ã€…ã®ä½œæ¥­ã‚’ã€Œçœã‚¨ãƒã€ï¼',url:'',video:true},
        {id:'chest',cat:'é‹å‹•',title:'ãƒã‚§ã‚¹ãƒˆã‚¹ãƒˆãƒ¬ãƒƒãƒï¼ˆåº§ä½ï¼‰',desc:'æ°—åˆ†è»¢æ›ã®ç°¡å˜ãªè‚©ç”²éª¨ã‚¨ã‚¯ã‚µã‚µã‚¤ã‚º',url:'',video:true},
        {id:'shoulder',cat:'é‹å‹•',title:'ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆåº§ä½ï¼‰',desc:'ç¶ºéº—ãªå††ã‚’æãè‚©ã®å‹•ãã‚’æ‰‹ã«å…¥ã‚Œã‚‹',url:'',video:true},
        {id:'heel',cat:'é‹å‹•',title:'ãƒ’ãƒ¼ãƒ«ãƒ¬ã‚¤ã‚ºï¼ˆç«‹ä½ï¼‰',desc:'ãµãã‚‰ã¯ãã‚’é›ãˆã¦ç«‹ã¡ä»•äº‹ã«å¯¾å¿œï¼',url:'',video:true},
        {id:'twist',cat:'é‹å‹•',title:'ãƒ„ã‚¤ã‚¹ãƒˆãƒªãƒ¼ãƒï¼ˆç«‹ä½ï¼‰',desc:'ããã‚Šå‹•ä½œã®å‹•ãã‚’ã‚¹ãƒ ãƒ¼ã‚ºã«ã™ã‚‹ãŸã‚ã«',url:'https://youtu.be/CqqOfgSMOAs',video:true}
      ],
      high: [
        {id:'jack',cat:'é«˜å¼·åº¦',title:'ã‚¸ãƒ£ãƒƒã‚¯ãƒŠã‚¤ãƒ•ã‚¹ãƒˆãƒ¬ãƒƒãƒï¼ˆç«‹ä½ï¼‰',desc:'20ç§’ã§å‰å±ˆãŒæŸ”ã‚‰ã‹ããªã‚‹ï¼ï¼Ÿ',url:'https://youtu.be/nAP1QCuUdAY',video:true},
        {id:'balance',cat:'é«˜å¼·åº¦',title:'ãƒãƒ©ãƒ³ã‚¹ãƒãƒ£ãƒ¬ãƒ³ã‚¸ï¼ˆç«‹ä½ï¼‰',desc:'ç‰‡è„šç«‹ã¡ã®æ¥µæ„ã‚’æ‰‹ã«å…¥ã‚Œã‚ˆã†ï¼',url:'',video:true},
        {id:'drawing',cat:'é«˜å¼·åº¦',title:'ãŠçµµæããƒãƒ©ãƒ³ã‚¹ï¼ˆç«‹ä½ï¼‰',desc:'éŠã³ã«è¦‹ãˆã¦é›£æ˜“åº¦é«˜ã„ãƒãƒ©ãƒ³ã‚¹ç·´ç¿’',url:'https://youtu.be/nanwI0Jf4Q8',video:true},
        {id:'banzai',cat:'é«˜å¼·åº¦',title:'å…¨èº«ãƒãƒ³ã‚¶ã‚¤ï¼ˆç«‹ä½ï¼‰',desc:'ãƒˆãƒ¼ã‚¿ãƒ«ã‚¨ã‚¯ã‚µã‚µã‚¤ã‚ºï¼å¼·åº¦é«˜ã‚',url:'https://youtu.be/G4Neqz-dsuA',video:true}
      ],
      attention: [
        {id:'att1',cat:'æ³¨æ„',title:'æ³¨æ„Lv1',desc:'çŸ­æ™‚é–“ã®åŸºç¤',url:'',video:true},
        {id:'att2',cat:'æ³¨æ„',title:'æ³¨æ„Lv2',desc:'åŸºç¤ï¼‹ãƒªã‚ºãƒ ',url:'',video:true},
        {id:'att3',cat:'æ³¨æ„',title:'æ³¨æ„Lv3',desc:'æ¡ä»¶ä»˜ãé¸æŠ',url:'',video:true},
        {id:'att4',cat:'æ³¨æ„',title:'æ³¨æ„Lv4',desc:'å¹²æ¸‰ä¸‹ã®æ³¨æ„',url:'',video:true},
        {id:'att5',cat:'æ³¨æ„',title:'æ³¨æ„Lv5',desc:'ç¾å ´å‹å¿œç”¨',url:'',video:true},
        {id:'attfruit',cat:'æ³¨æ„',title:'æ³¨æ„é‡èœãƒ•ãƒ«ãƒ¼ãƒ„',desc:'è¨€èªâ†’è¦–è¦šé€£å‹•',url:'',video:true}
      ],
      life: [
        {id:'life1',cat:'ç”Ÿæ´»',title:'ç§»å‹•ã¯å¤§è‚¡æ„è­˜',desc:'ã¤ã¾å…ˆã§åœ°é¢ã‚’è¹´ã£ã¦é€²ã‚€',url:'',video:false},
        {id:'life2',cat:'ç”Ÿæ´»',title:'éšæ®µå„ªå…ˆã§ç§»å‹•',desc:'å®‰å…¨ã®ç¯„å›²ã§ç©æ¥µçš„ã«éšæ®µåˆ©ç”¨',url:'',video:false},
        {id:'life3',cat:'ç”Ÿæ´»',title:'åˆå¾Œã¯ã‚«ãƒ•ã‚§ã‚¤ãƒ³æ§ãˆã‚',desc:'ç¡çœ ã®è³ªã‚’å®ˆã‚‹',url:'',video:false},
        {id:'life4',cat:'ç”Ÿæ´»',title:'é–“é£Ÿã¯ãŸã‚“ã±ãè³ªå¯„ã›',desc:'å°è…¹æº€ãŸã—ã‚‚ä½“ã¥ãã‚Šå¯„ã›ã«',url:'',video:false},
        {id:'life5',cat:'ç”Ÿæ´»',title:'æœ€åˆã«é‡èœä¸€å£',desc:'è¡€ç³–ã‚¹ãƒ‘ã‚¤ã‚¯äºˆé˜²',url:'',video:false},
        {id:'life6',cat:'ç”Ÿæ´»',title:'å°±å¯å‰ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³5åˆ†',desc:'è»½ã„æº–å‚™ã§ç¡çœ ã‚¹ã‚¤ãƒƒãƒON',url:'',video:false},
        {id:'life7',cat:'ç”Ÿæ´»',title:'æœã®æ¡å…‰1åˆ†',desc:'é®å…‰ã‚«ãƒ¼ãƒ†ãƒ³é–‹ã‘ã‚‹ã ã‘ã§ã‚‚OK',url:'',video:false},
        {id:'life8',cat:'ç”Ÿæ´»',title:'æ¤…å­ã«åº§ã‚‹æ™‚ã¯å„ªã—ã',desc:'ã€Œè½ã¡ãªã„ã€ã§ã€Œåº§ã‚‹ã€',url:'',video:false},
        {id:'life9',cat:'ç”Ÿæ´»',title:'æ­¯ç£¨ãã¯ç‰‡è„šç«‹ã¡ã§',desc:'æ´—é¢å°ã‚’æ”¯ç‚¹ã«å®‰å…¨ç¢ºä¿ã§',url:'',video:false},
        {id:'life10',cat:'ç”Ÿæ´»',title:'ä¼‘æ†©æ™‚é–“ã®é›‘è«‡ã‚’1åˆ†',desc:'ä»•äº‹ã¨é–¢ä¿‚ãªã„è©±é¡Œ1ã¤',url:'',video:false},
        {id:'life11',cat:'ç”Ÿæ´»',title:'ã‚¢ã‚¤ã‚³ãƒ³ã‚¿ã‚¯ãƒˆã‚’æ„è­˜ã—ãŸä»•äº‹',desc:'ç›¸æ‰‹ã®ç›®ã‚’ä¸€åº¦ã—ã£ã‹ã‚Šè¦‹ã‚‹',url:'',video:false},
        {id:'life12',cat:'ç”Ÿæ´»',title:'å‹•ä½œã®é †ç•ªã‚’å£°ã«å‡ºã—ã¦ç¢ºèª',desc:'1ãƒ•ãƒ¬ãƒ¼ã‚ºã§OK',url:'',video:false},
        {id:'life13',cat:'ç”Ÿæ´»',title:'ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¯è†ã‚’ä½¿ã†',desc:'è…•ã˜ã‚ƒãªãä¸‹åŠèº«ã§',url:'',video:false},
        {id:'life14',cat:'ç”Ÿæ´»',title:'ç›®ç·šã‚’é ãã¸',desc:'30ï½60åˆ†ã”ã¨ã«é ãã¸',url:'',video:false},
        {id:'life15',cat:'ç”Ÿæ´»',title:'ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ä»–ã®äººã«ç´¹ä»‹',desc:'è‡ªåˆ†ã®å®Ÿæ–½ã—ãŸã‚¹ã‚¿ãƒ³ãƒ—ã‚’èª°ã‹ã«å…±æœ‰ã™ã‚‹ï¼è©±ã™',url:'',video:false}
      ]
    };

    // å…¨ã‚¹ã‚¿ãƒ³ãƒ—ã‚’1ã¤ã®é…åˆ—ã«
    const ALL_STAMPS = [...STAMPS.exercise, ...STAMPS.high, ...STAMPS.attention, ...STAMPS.life];

    // ====== ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ======
    const qs = (s) => document.querySelector(s);
    const qsa = (s) => Array.from(document.querySelectorAll(s));

    // ====== ã‚«ã‚¦ãƒ³ãƒˆä¿å­˜ ======
    function todayKey() {
      const d = new Date();
      return `${d.getFullYear()}-${d.getMonth() + 1}-${d.getDate()}`;
    }
    function weekKey() {
      const d = new Date();
      const onejan = new Date(d.getFullYear(), 0, 1);
      const week = Math.ceil((((d - onejan) / 86400000) + onejan.getDay() + 1) / 7);
      return `${d.getFullYear()}-W${week}`;
    }
    function loadCounts() {
      const dk = todayKey();
      if (localStorage.getItem('day_key') !== dk) {
        localStorage.setItem('day_key', dk);
        localStorage.setItem('day_count', '0');
      }
      const wk = weekKey();
      const storedWeek = localStorage.getItem('week_key');
      if (storedWeek !== wk) {
        // é€±ãŒå¤‰ã‚ã£ãŸã‚‰å…ˆé€±ã®ã‚«ã‚¦ãƒ³ãƒˆã‚’ä¿å­˜
        const oldCount = localStorage.getItem('week_count') || '0';
        localStorage.setItem('last_week_count', oldCount);
        localStorage.setItem('week_key', wk);
        localStorage.setItem('week_count', '0');
      }
    }
    function incrementDay() {
      const n = parseInt(localStorage.getItem('day_count') || '0', 10) + 1;
      localStorage.setItem('day_count', String(n));
    }
    function incrementWeek() {
      const n = parseInt(localStorage.getItem('week_count') || '0', 10) + 1;
      localStorage.setItem('week_count', String(n));
    }
    function updateCounters() {
      const dc = qs('#dayCount');
      const wc = qs('#weekCount');
      if (dc) dc.textContent = localStorage.getItem('day_count') || '0';
      if (wc) wc.textContent = localStorage.getItem('week_count') || '0';
      
      // é€±æ¯”è¼ƒãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
      updateWeeklyMessage();
    }
    
    function updateWeeklyMessage() {
      const currentWeek = parseInt(localStorage.getItem('week_count') || '0', 10);
      const lastWeek = parseInt(localStorage.getItem('last_week_count') || '0', 10);
      
      let message = '';
      if (lastWeek > 0) {
        const diff = currentWeek - lastWeek;
        const diffPercent = Math.round((diff / lastWeek) * 100);
        
        if (diff > 0) {
          message = `ğŸ‰ å…ˆé€±ã‚ˆã‚Šã‚‚${Math.abs(diffPercent)}%è‰¯ã„ãƒšãƒ¼ã‚¹ï¼`;
        } else if (diff < 0) {
          message = `ğŸ’­ å…ˆé€±ã«æ¯”ã¹ã¦é¸æŠçš„ã«ãªã‚Šã¾ã—ãŸ`;
        } else {
          message = `âœ… å…ˆé€±ã¨åŒã˜ãƒšãƒ¼ã‚¹ã§ã™`;
        }
      }
      
      // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºç”¨ã®è¦ç´ ã‚’æ¢ã™
      let msgEl = qs('#weeklyComparisonMsg');
      if (!msgEl) {
        // ä»Šé€±ã®å–ã‚Šçµ„ã¿ã®ä¸‹ã«è¿½åŠ 
        const weekCountDiv = qs('#weekCount');
        if (weekCountDiv && weekCountDiv.parentElement && weekCountDiv.parentElement.parentElement) {
          const parentDiv = weekCountDiv.parentElement.parentElement;
          msgEl = document.createElement('div');
          msgEl.id = 'weeklyComparisonMsg';
          msgEl.className = 'small';
          msgEl.style.marginTop = '8px';
          msgEl.style.fontWeight = '600';
          parentDiv.appendChild(msgEl);
        }
      }
      
      if (msgEl) {
        msgEl.textContent = message;
      }
    }

    // ====== ç”»é¢åˆ‡æ›¿ ======
    const KNOWN_VIEWS = ['consentView', 'employeeIdView', 'homeView', 'stampsView', 'calendarView', 'menuView', 'submitView'];
    function safeClass(op, el, cls) {
      if (el) {
        el.classList[op](cls);
      }
    }
    function show(id) {
      KNOWN_VIEWS.forEach(v => {
        const el = qs('#' + v);
        safeClass('add', el, 'hidden');
      });
      const target = qs('#' + id);
      safeClass('remove', target, 'hidden');
      const tabs = [{id: 'homeView', tab: '#homeTab'}, {id: 'stampsView', tab: '#stampsTab'}, {id: 'calendarView', tab: '#calendarTab'}, {id: 'menuView', tab: '#menuTab'}];
      tabs.forEach(t => {
        const el = qs(t.tab);
        if (el) el.classList.remove('active');
      });
      const active = tabs.find(t => t.id === id);
      if (active) {
        const el = qs(active.tab);
        if (el) el.classList.add('active');
      }
      const titleMap = {homeView: 'ä»Šæ—¥ã®ãƒãƒ£ãƒ¬ãƒ³ã‚¸', stampsView: 'ã‚¹ã‚¿ãƒ³ãƒ—ä¸€è¦§', calendarView: 'ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼', menuView: 'ãƒ¡ãƒ‹ãƒ¥ãƒ¼', consentView: 'åŒæ„', employeeIdView: 'ç¤¾å“¡IDç™»éŒ²', submitView: 'æå‡º'};
      const at = qs('#appTitle');
      if (at) at.textContent = titleMap[id] || 'è¡Œå‹•æ”¯æ´ã‚¢ãƒ—ãƒª';
    }

    // ====== å®Œäº†å‡¦ç† ======
    function markDone(stampId) {
      incrementDay();
      incrementWeek();
      updateCounters();
      
      // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«ã‚‚è¨˜éŒ²
      const today = new Date();
      const key = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
      const map = readDateCounts();
      map[key] = (map[key] || 0) + 1;
      writeDateCounts(map);
      
      // ã‚¹ã‚¿ãƒ³ãƒ—å±¥æ­´ä¿å­˜
      saveStampLog(stampId);
      
      // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æ›´æ–°
      const cal = qs('#calendarView');
      if (cal && !cal.classList.contains('hidden')) renderCalendar(currentCal.y, currentCal.m);
    }

    // ====== ã‚¹ã‚¿ãƒ³ãƒ—å±¥æ­´ ======
    function saveStampLog(stampId) {
      try {
        const logs = JSON.parse(localStorage.getItem('stamp_logs') || '[]');
        logs.push({
          stampId: stampId,
          timestamp: new Date().toISOString(),
          date: todayKey()
        });
        localStorage.setItem('stamp_logs', JSON.stringify(logs));
      } catch (e) {
        console.error('Failed to save stamp log:', e);
      }
    }

    // ====== ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ ======
    const CAL_START = {y: 2025, m: 11};
    function getDaysInMonth(y, m) {
      return new Date(y, m, 0).getDate();
    }
    function getFirstWeekday(y, m) {
      return new Date(y, m - 1, 1).getDay();
    }
    function readDateCounts() {
      try {
        return JSON.parse(localStorage.getItem('date_counts') || '{}');
      } catch (e) {
        return {};
      }
    }
    function writeDateCounts(map) {
      localStorage.setItem('date_counts', JSON.stringify(map));
    }
    let currentCal = {y: CAL_START.y, m: CAL_START.m};
    function renderCalendar(y, m) {
      const grid = qs('#calendarGrid');
      const head = qs('#calHeader');
      if (!grid || !head) return;
      head.textContent = `${y}å¹´${m}æœˆ`;
      const weekdays = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
      const first = getFirstWeekday(y, m);
      const days = getDaysInMonth(y, m);
      const counts = readDateCounts();
      let html = '';
      weekdays.forEach(w => {
        html += `<div class="weekday">${w}</div>`;
      });
      for (let i = 0; i < first; i++) {
        html += '<div></div>';
      }
      for (let d = 1; d <= days; d++) {
        const key = `${y}-${String(m).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
        const c = counts[key] || 0;
        let dot = '';
        if (c >= 3) dot = '<span class="dot g"></span>';
        else if (c >= 1) dot = '<span class="dot b"></span>';
        html += `<div class="day"><span class="num">${d}</span><span>${dot}</span></div>`;
      }
      grid.innerHTML = html;
    }
    function changeMonth(delta) {
      let y = currentCal.y, m = currentCal.m + delta;
      if (m < 1) {
        m = 12;
        y--;
      } else if (m > 12) {
        m = 1;
        y++;
      }
      currentCal = {y, m};
      renderCalendar(y, m);
    }

    // ====== ãŠã™ã™ã‚è¡¨ç¤º ======
    function pickRandom(arr) {
      return arr[Math.floor(Math.random() * arr.length)];
    }
    function renderRecommendations() {
      const holder = qs('#recommendList');
      if (!holder) return;
      holder.innerHTML = '';
      
      // é‹å‹•ãƒ»æ³¨æ„ãƒ»ç”Ÿæ´»ã‹ã‚‰å„1ã¤ãšã¤
      const ex = pickRandom(STAMPS.exercise);
      const at = pickRandom(STAMPS.attention);
      const lf = pickRandom(STAMPS.life);
      
      [ex, at, lf].forEach((item, idx) => {
        const catClass = item.cat === 'é‹å‹•' ? 'cat-exercise' : item.cat === 'æ³¨æ„' ? 'cat-attention' : 'cat-lifestyle';
        const badgeClass = item.cat === 'é‹å‹•' ? 'cat-ex' : item.cat === 'æ³¨æ„' ? 'cat-at' : 'cat-life';
        // é‹å‹•ãƒ»é«˜å¼·åº¦ã¯å¸¸ã«å‹•ç”»ãƒœã‚¿ãƒ³è¡¨ç¤ºã€ãã‚Œä»¥å¤–ã¯URLãŒã‚ã‚‹å ´åˆã®ã¿
        let videoBtn = '';
        if (item.cat === 'é‹å‹•' || item.cat === 'é«˜å¼·åº¦') {
          videoBtn = `<button class="btn secondary video-btn" onclick="openVideo('${item.url}')">å‹•ç”»</button>`;
        } else if (item.video && item.url) {
          videoBtn = `<button class="btn secondary video-btn" onclick="openVideo('${item.url}')">å‹•ç”»</button>`;
        }
        
        holder.insertAdjacentHTML('beforeend', `
          <article class="card ${catClass}" data-stamp="${item.id}">
            <div class="inline"><span class="badge ${badgeClass}">${item.cat}</span></div>
            <div class="title">${item.title}</div>
            <div class="sub">${item.desc || ''}</div>
            <div class="inline" style="gap:8px; margin-top:auto">
              <button class="btn" onclick="markDone('${item.id}'); this.textContent='å®Œäº†ï¼'; this.disabled=true;">å®Ÿæ–½ã—ãŸ</button>
              ${videoBtn}
            </div>
          </article>
        `);
      });
    }

    // ====== å…¨ã‚¹ã‚¿ãƒ³ãƒ—è¡¨ç¤º (3åˆ—ã‚«ãƒ†ã‚´ãƒªåˆ¥) ======
    function renderAllStamps() {
      const holder = qs('#stampsList');
      if (!holder) return;
      
      // ã‚«ãƒ†ã‚´ãƒªåˆ¥ã«çµ„ç¹”åŒ–
      const exerciseStamps = [...STAMPS.exercise, ...STAMPS.high]; // é‹å‹•+é«˜å¼·åº¦
      const attentionStamps = STAMPS.attention; // æ³¨æ„
      const lifeStamps = STAMPS.life; // ç”Ÿæ´»
      
      holder.innerHTML = `
        <div class="stamps-grid">
          <div class="stamp-category">
            <h4 style="background:#dcfce7;color:#166534;border:1px solid #bbf7d0">ğŸƒ é‹å‹•ãƒ»é«˜å¼·åº¦</h4>
            <div class="cards" style="grid-template-columns:1fr">${renderCategoryStamps(exerciseStamps)}</div>
          </div>
          <div class="stamp-category">
            <h4 style="background:#dbeafe;color:#1e40af;border:1px solid #bfdbfe">ğŸ§  æ³¨æ„</h4>
            <div class="cards" style="grid-template-columns:1fr">${renderCategoryStamps(attentionStamps)}</div>
          </div>
          <div class="stamp-category">
            <h4 style="background:#fef3c7;color:#78350f;border:1px solid #fde68a">ğŸŒ± ç”Ÿæ´»</h4>
            <div class="cards" style="grid-template-columns:1fr">${renderCategoryStamps(lifeStamps)}</div>
          </div>
        </div>
      `;
    }
    
    function renderCategoryStamps(stamps) {
      return stamps.map(item => {
        const catClass = item.cat === 'é‹å‹•' ? 'cat-exercise' : item.cat === 'é«˜å¼·åº¦' ? 'cat-exercise' : item.cat === 'æ³¨æ„' ? 'cat-attention' : 'cat-lifestyle';
        const badgeClass = item.cat === 'é‹å‹•' ? 'cat-ex' : item.cat === 'é«˜å¼·åº¦' ? 'warn' : item.cat === 'æ³¨æ„' ? 'cat-at' : 'cat-life';
        const badgeText = item.cat === 'é«˜å¼·åº¦' ? 'é«˜å¼·åº¦' : item.cat;
        // é‹å‹•ãƒ»é«˜å¼·åº¦ã¯å¸¸ã«å‹•ç”»ãƒœã‚¿ãƒ³è¡¨ç¤ºã€ãã‚Œä»¥å¤–ã¯URLãŒã‚ã‚‹å ´åˆã®ã¿
        let videoBtn = '';
        if (item.cat === 'é‹å‹•' || item.cat === 'é«˜å¼·åº¦') {
          videoBtn = `<button class="btn secondary video-btn" onclick="openVideo('${item.url}')">å‹•ç”»</button>`;
        } else if (item.video && item.url) {
          videoBtn = `<button class="btn secondary video-btn" onclick="openVideo('${item.url}')">å‹•ç”»</button>`;
        }
        
        return `
          <article class="card ${catClass}">
            <div class="inline"><span class="badge ${badgeClass}">${badgeText}</span></div>
            <div class="title">${item.title}</div>
            <div class="sub">${item.desc}</div>
            <div class="inline" style="gap:8px;margin-top:auto">
              <button class="btn" onclick="markDone('${item.id}'); this.textContent='å®Œäº†ï¼'; this.disabled=true;">å®Ÿæ–½ã—ãŸ</button>
              ${videoBtn}
            </div>
          </article>
        `;
      }).join('');
    }

    // ====== å‹•ç”»å†ç”Ÿ ======
    function openVideo(url) {
      if (url && /^https?:\/\//.test(url)) {
        window.open(url, '_blank', 'noopener');
      } else {
        alert('å‹•ç”»URLã¯æº–å‚™ä¸­ã§ã™');
      }
    }

    // ====== CSVå‡ºåŠ› ======
    function buildCSV() {
      const dk = todayKey();
      const wk = weekKey();
      const day = localStorage.getItem('day_count') || '0';
      const week = localStorage.getItem('week_count') || '0';
      const employeeId = localStorage.getItem('employee_id') || '';
      const logs = JSON.parse(localStorage.getItem('stamp_logs') || '[]');
      
      let csv = 'employee_id,date,week,day_count,week_count,stamp_id,timestamp\n';
      
      if (logs.length > 0) {
        logs.forEach(log => {
          csv += `"${employeeId}","${log.date}","${wk}","${day}","${week}","${log.stampId}","${log.timestamp}"\n`;
        });
      } else {
        csv += `"${employeeId}","${dk}","${wk}","${day}","${week}","",""\n`;
      }
      
      return csv;
    }
    
    function download(filename, text) {
      const a = document.createElement('a');
      a.href = URL.createObjectURL(new Blob([text], {type: 'text/csv'}));
      a.download = filename;
      a.click();
      URL.revokeObjectURL(a.href);
    }
    
    function exportCSV() {
      const csv = buildCSV();
      download(`activity_${todayKey()}.csv`, csv);
      const el = qs('#submitMsg');
      if (el) el.textContent = 'CSVã‚’ç«¯æœ«ã«ä¿å­˜ã—ã¾ã—ãŸã€‚';
    }
    
    function submitCSV() {
      const el = qs('#submitMsg');
      const csv = buildCSV();
      if (!GAS_URL) {
        if (el) el.textContent = 'é€ä¿¡å…ˆURLãŒæœªè¨­å®šã§ã™ã€‚ç®¡ç†è€…ã¸ã”é€£çµ¡ãã ã•ã„ã€‚';
        return;
      }
      if (el) el.textContent = 'é€ä¿¡ä¸­â€¦';
      
      const employeeId = localStorage.getItem('employee_id') || '';
      const url = GAS_URL + 
        '?callback=submitCallback' +
        '&token=' + encodeURIComponent(API_TOKEN) +
        '&employeeId=' + encodeURIComponent(employeeId) +
        '&csv=' + encodeURIComponent(csv);
      
      // JSONPç”¨ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã‚’å®šç¾©
      window.submitCallback = function(data) {
        const el = qs('#submitMsg');
        if (data && (data.ok || data.status === 'ok')) {
          if (el) el.textContent = 'æå‡ºãŒå®Œäº†ã—ã¾ã—ãŸã€‚ã”å”åŠ›ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚';
        } else {
          if (el) el.textContent = 'æå‡ºã«å¤±æ•—ã—ã¾ã—ãŸ: ' + (data?.error || 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼');
        }
      };
      
      // JSONPé€ä¿¡
      const script = document.createElement('script');
      script.src = url;
      script.onerror = function() {
        const el = qs('#submitMsg');
        if (el) el.textContent = 'æå‡ºã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ™‚é–“ã‚’ãŠã„ã¦å†è©¦è¡Œã™ã‚‹ã‹ã€CSVä¿å­˜â†’æ‰‹å‹•æå‡ºã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚';
      };
      document.body.appendChild(script);
    }

    // ====== ç¤¾å“¡IDç®¡ç† ======
    function changeEmployeeId() {
      const newId = prompt('æ–°ã—ã„ç¤¾å“¡IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', localStorage.getItem('employee_id') || '');
      if (newId && newId.trim()) {
        localStorage.setItem('employee_id', newId.trim());
        alert('ç¤¾å“¡IDã‚’å¤‰æ›´ã—ã¾ã—ãŸ');
      }
    }

    // ====== åˆæœŸåŒ– ======
    function init() {
      loadCounts();
      updateCounters();
      
      const consent = localStorage.getItem('consent_v1') === 'true';
      const employeeId = localStorage.getItem('employee_id');
      
      if (!consent) {
        show('consentView');
      } else if (!employeeId) {
        show('employeeIdView');
      } else {
        show('homeView');
      }
      
      const pm = qs('#prevMonthBtn'), nm = qs('#nextMonthBtn');
      if (pm) pm.addEventListener('click', () => changeMonth(-1));
      if (nm) nm.addEventListener('click', () => changeMonth(1));
      
      renderRecommendations();
      renderAllStamps();
      renderCalendar(currentCal.y, currentCal.m);
    }

    // ====== ã‚¤ãƒ™ãƒ³ãƒˆ ======
    document.addEventListener('DOMContentLoaded', () => {
      // åŒæ„ç”»é¢
      const consentCheck = qs('#consentCheck');
      const consentBtn = qs('#consentBtn');
      if (consentCheck && consentBtn) {
        consentCheck.addEventListener('change', () => {
          consentBtn.disabled = !consentCheck.checked;
        });
        consentBtn.addEventListener('click', () => {
          localStorage.setItem('consent_v1', 'true');
          show('employeeIdView');
        });
      }
      
      // ç¤¾å“¡IDç™»éŒ²
      const employeeIdBtn = qs('#employeeIdBtn');
      const employeeIdInput = qs('#employeeIdInput');
      if (employeeIdBtn && employeeIdInput) {
        employeeIdBtn.addEventListener('click', () => {
          const id = employeeIdInput.value.trim();
          if (!id) {
            alert('ç¤¾å“¡IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
            return;
          }
          localStorage.setItem('employee_id', id);
          show('homeView');
        });
      }
      
      // ã‚¿ãƒ–åˆ‡æ›¿
      [['#homeTab', 'homeView'], ['#stampsTab', 'stampsView'], ['#calendarTab', 'calendarView'], ['#menuTab', 'menuView'], ['#toMenuBtn', 'menuView']].forEach(([sel, view]) => {
        const el = qs(sel);
        if (el) {
          el.addEventListener('click', () => show(view));
        }
      });
      
      // CSVå‡ºåŠ›
      const exportBtn = qs('#exportBtn');
      const submitBtn = qs('#submitBtn');
      if (exportBtn) exportBtn.addEventListener('click', exportCSV);
      if (submitBtn) submitBtn.addEventListener('click', submitCSV);
    });

    // èµ·å‹•
    init();
  </script>
</body>
</html>
